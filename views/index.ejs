<!DOCTYPE html>
<html lang="en">
<%- include("./head.ejs") %>

<body class="bg-gray-100">

	<div class="max-w-7xl mx-auto px-4 py-8">

		<!-- PAGE TITLE -->
		<h1 class="text-3xl font-bold mb-6 text-gray-800">
			All Products
		</h1>

		<!-- SEARCH & FILTER -->
		<form
			method="GET"
			action="/"
			class="bg-white p-4 rounded-lg shadow mb-8 flex flex-col md:flex-row gap-4"
		>
			<!-- Search -->
			<input
				type="text"
				name="search"
				placeholder="Search by name or description..."
				value="<%= query.search || '' %>"
				class="w-full md:w-1/2 px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
			/>

			<!-- Category Filter -->
			<select
				name="category"
				class="w-full md:w-1/4 px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
			>
				<option value="">All Categories</option>
				<% categories.forEach(cat => { %>
					<option
						value="<%= cat._id %>"
						<%= query.category == cat._id ? 'selected' : '' %>
					>
						<%= cat.name %>
					</option>
				<% }) %>
			</select>

			<!-- Submit -->
			<button
				type="submit"
				class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition"
			>
				Apply
			</button>
		</form>

		<!-- EMPTY STATE -->
		<% if (!products.length) { %>
			<div class="text-center text-gray-500 mt-20 text-lg">
				No products found.
			</div>
		<% } else { %>

		<!-- PRODUCTS GRID -->
		<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
			<% products.forEach(p => { %>
				<div class="bg-white rounded-lg shadow hover:shadow-lg transition overflow-hidden">

					<!-- Image -->
					<img
						src="<%= p.image.secure_url %>"
						alt="<%= p.name %>"
						class="h-48 w-full object-cover"
					/>

					<!-- Content -->
					<div class="p-4">
						<h3 class="text-lg font-semibold text-gray-800">
							<%= p.name %>
						</h3>

						<p class="text-sm text-gray-600 mt-1 line-clamp-2">
							<%= p.description %>
						</p>

						<div class="flex justify-between items-center mt-4">
							<span class="text-xs bg-gray-200 px-2 py-1 rounded">
								<%= p.category.name %>
							</span>

							<a
								href="/product/<%= p.slug %>"
								class="text-blue-600 text-sm font-medium hover:underline"
							>
								View
							</a>
						</div>
					</div>

				</div>
			<% }) %>
		</div>

		<% } %>

	</div>

</body>
</html>
